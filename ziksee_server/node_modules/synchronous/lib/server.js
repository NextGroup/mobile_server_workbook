/*!
 * Synchronous
 * Copyright(c) 2011 Chris O'Hara <cohara87@gmail.com>
 * MIT Licensed
 */

 /**
  * Give each {http,https,net} request it's own fiber.
  */

['http','https','net'].forEach(function (server) {
    var server = require(server)
      , createServer = server.createServer;
    server.createServer = function (handler) {
        var context = this;
        return createServer.call(this, function (req, res) {
            Fiber(function () {
                handler.call(context, req, res);
            }).run();
        });
    }
});
